<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>S3 Upload Test</title>
  </head>
  <body>
    <h1>S3 Upload Test</h1>
    <button id="testUpload">Test Upload</button>
    <div id="result"></div>

    <script>
      document.getElementById('testUpload').addEventListener('click', async () => {
        const resultDiv = document.getElementById('result')
        resultDiv.innerHTML = 'Testing...'

        try {
          // Create a test blob
          const testData = 'Hello, this is a test file!'
          const blob = new Blob([testData], { type: 'text/plain' })

          const bucketName = 'koma-mobile-test-20250618-013942'
          const key = 'test/test-upload.txt'
          const url = `https://${bucketName}.s3.ap-northeast-1.amazonaws.com/${key}`

          console.log('Attempting upload to:', url)

          const response = await fetch(url, {
            method: 'PUT',
            body: blob,
            headers: {
              'Content-Type': 'text/plain',
            },
            mode: 'cors',
          })

          console.log('Upload response:', {
            status: response.status,
            statusText: response.statusText,
            headers: Object.fromEntries(response.headers.entries()),
          })

          if (response.ok) {
            resultDiv.innerHTML = `<div style="color: green;">✅ Upload successful! Status: ${response.status}</div>`
          } else {
            resultDiv.innerHTML = `<div style="color: red;">❌ Upload failed: ${response.status} ${response.statusText}</div>`
          }
        } catch (error) {
          console.error('Upload error:', error)
          resultDiv.innerHTML = `<div style="color: red;">❌ Upload error: ${error.message}</div>`
        }
      })
    </script>
  </body>
</html>
